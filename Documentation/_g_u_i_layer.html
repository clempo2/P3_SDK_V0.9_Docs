<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P3-SDK: The GUI Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">P3-SDK<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">P3 Software Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_g_u_i_layer.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The GUI Layer </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__docs_270_01_the_01_g_u_i_01_layer"></a></p>
<h1 class="doxsection"><a class="anchor" id="Scenes"></a>
Scenes of an App</h1>
<p>A Unity app is a collection of scenes. Each scene is a 3D graphical environment in which the action plays out. Because Unity is a video game platform, other resources may refer to scenes as "levels". In P3 development, the "Scene" is also the abstraction that consists of presenting the player with a visual environment and related playfied/display interactions, analogous to a mode in traditional pinball play. From a development perspective, each logical Scene consists of both a Unity/Presentation component (the SceneController) and a Mode-side logic component (the SceneMode).</p>
<p>A P3 app starts with a fairly empty Bootstrap scene which starts the P3Controller so that the modes can be executed.</p>
<p>The following scene is the Attract scene. This is what the player sees when they are in the app but a game isn't being played yet.</p>
<p>When a game starts, it goes to the first scene of the game, known as the Home scene.</p>
<p>P3SA implements all of the above scenes.</p>
<p>The Home scene can be renamed to suit your app. For example, Lexy Lightspeed's home scene is internally named "Map".</p>
<p>The Home scene is also not likely to be the only scene in your game. For example, Lexy Lightspeed's Map/Home scene causes other scenes to be loaded, such as the Warehouse, Weapons Lab and Cabin scenes.</p>
<h1 class="doxsection"><a class="anchor" id="AnatomyOfScene"></a>
Anatomy of a Scene</h1>
<p>Scenes can be found in the asset folder under Assets/Scenes. Within that folder each scene also has its own folder for scene-specific assets.</p>
<p>Each Unity scene will also have a corresponding mode, found in Assets/Scripts/P3SA/Modes/SceneModes.</p>
<p>Every scene contains a scene controller and several GameObjects. Some of those objects will be P3Aware objects so that they can communicate with the modes.</p>
<p>When the scene starts, the scene controller will automatically add some objects to the scene, such as an instance of P3Playfield (for positional reference) and an audio controller.</p>
<dl class="section see"><dt>See also</dt><dd>Sections <a class="el" href="#P3AwareObjects">P3Aware Objects</a> and <a class="el" href="#P3Playfield">P3Playfield</a></dd></dl>
<h1 class="doxsection"><a class="anchor" id="SceneController"></a>
Scene Controller</h1>
<p>Every Unity scene needs a unique scene controller attached to it. The role of the scene controller is to enable the Unity scene be able to interface with the P3 framework/Mode-side logic. The Scene Controller handles all the P3App specifics that are required to manage and allow interactions between the Unity scene and Mode-side code (ie, connect to p3 interface, handle scene change requests, post events to Modes, receive events from modes, instantiate &lt;AppCode&gt;Audio, connect to p3playfield, etc.).</p>
<p>For example, P3SA contains scenes called Attract and Home. Each of those scenes contains a Unity GameObject - called AttractSceneController and HomeSceneController respectively - and each of which have an attached script component of the same name (<a class="el" href="class_multimorphic_1_1_p3_s_a_1_1_g_u_i_1_1_home_scene_controller.html">HomeSceneController</a> and <a class="el" href="class_multimorphic_1_1_p3_s_a_1_1_g_u_i_1_1_attract_scene_controller.html">AttractSceneController</a>). They inherit from the app-specific class <a class="el" href="class_multimorphic_1_1_p3_s_a_1_1_g_u_i_1_1_p3_s_a_scene_controller.html">P3SASceneController</a>, which in turn inherits from the base class <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_scene_controller.html">SceneController</a>.</p>
<p>The scene controller takes responsibility for:</p><ul>
<li>Ensuring that all game objects are correctly instantiated, initialized and positioned for the opening of the scene or when the scene is reset for the beginning of a ball.</li>
<li>Handling any intro required for the scene</li>
<li>Updating any in-scene objects as required during scene execution (some objects may listen directly to the events from the mode and behave individually, while other objects will be updated by the scene controller based on the scene controller's receipt of mode events)</li>
<li>Handling any outro required for the scene</li>
<li>Ensuring that all in-scene objects are disposed of as necessary.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd>Section <a class="el" href="_adding_game_content.html#AddScene">Adding a Scene</a></dd></dl>
<h1 class="doxsection"><a class="anchor" id="P3AwareObjects"></a>
P3Aware Objects</h1>
<p>GameObjects which need to communicate with the mode layer can add a script which descends from the <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_p3_aware.html">P3Aware</a> class. This class descends from MonoBehaviour so it has the usual Awake, Start and Update methods. These can be overridden, but be sure to remember to call the base class version of the method in your overridden method.</p>
<p>For a P3Aware object to send an event to the modes, it just needs to call PostGUIEventToModes.</p>
<p>For a P3Aware object to receive an event from the modes, it needs to first have an event handler method using the AddModeEventHandler method. This can be done at any time, but it is convenient to do it in the CreateEventHandlers method. There is no need to unregister the event handler - this is handled automatically by the P3Aware class.</p>
<p>P3Aware objects are also able to spawn popup scores.</p>
<dl class="section see"><dt>See also</dt><dd>Class <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_p3_aware.html">P3Aware</a> and Section <a class="el" href="_adding_game_content.html#PopupScores">Popup Scores</a>.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="CollisionDetection"></a>
Ball Collision Detection</h1>
<p>A virtual target is a Unity GameObject that can react when the physical ball rolls over it. Like a regular Unity GameObject collision, your GameObject will need a Rigidbody, a Collider and a script with an OnTriggerEnter (or similar) event handler.</p>
<p>The P3Aware class contains everything required to detect collision with the physical ball, so the script class will need to inherit from P3Aware. This gives access to the HitByBall method. </p><div class="fragment"><div class="line">public class MyHittableObject : P3Aware {</div>
<div class="line"> </div>
<div class="line">      public void OnTriggerEnter(Collider other) {</div>
<div class="line">          if (HitByBall(other)) {</div>
<div class="line">              PostGUIEventToModes(&quot;Evt_ObjectHit&quot;, position); // Let the mode layer know about the collision</div>
<div class="line">              // Add more GUI layer reaction code here</div>
<div class="line">          }</div>
<div class="line">      }</div>
<div class="line">}</div>
</div><!-- fragment --><p> P3Aware inherits from MonoBehaviour, so it has the usual Start and Update methods as well. <b>Be sure to include calls to base.Start() and base.Update() in your method implementations.</b></p>
<dl class="section see"><dt>See also</dt><dd>Section <a class="el" href="#P3AwareObjects">P3Aware Objects</a> and class <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_p3_aware.html">P3Aware</a></dd></dl>
<h1 class="doxsection"><a class="anchor" id="UIMovingTargetExample"></a>
A GUI Example: A Moving Virtual Target</h1>
<p>Here's an example of a script which allows a GameObject to communicate with the mode layer via events. In this case, if its collider is hit, it will tell the modes the name of the object that hit it. It will also listen for an event from the modes to tell it to move to a new location. </p><div class="fragment"><div class="line">using UnityEngine;</div>
<div class="line">using System.Collections;</div>
<div class="line">using Multimorphic.P3App.GUI;</div>
<div class="line">using Multimorphic.P3App.Logging;</div>
<div class="line"> </div>
<div class="line">namespace Multimorphic.P3SA.GUI {</div>
<div class="line"> </div>
<div class="line">    public class MovingTarget : P3Aware {</div>
<div class="line">    </div>
<div class="line">        // Use this for initialization</div>
<div class="line">        public override void Start() {</div>
<div class="line">            base.Start();</div>
<div class="line">            gameObject.collider.enabled = true;</div>
<div class="line">        }</div>
<div class="line">     </div>
<div class="line">        protected override void CreateEventHandlers() {</div>
<div class="line">            base.CreateEventHandlers();</div>
<div class="line">            AddModeEventHandler(&quot;Evt_MoveTarget&quot;, MoveTargetHandler);</div>
<div class="line">            // could add more AddModeEventHandler calls here</div>
<div class="line">        }</div>
<div class="line">     </div>
<div class="line">        public void MoveTargetHandler(string eventName, object eventData) {</div>
<div class="line">            // We&#39;re being told to move</div>
<div class="line">            int index = (int)eventData;</div>
<div class="line">            gameObject.transform.localPosition = new Vector3(</div>
<div class="line">                -7f + index,</div>
<div class="line">                gameObject.transform.localScale.y,</div>
<div class="line">                Random.Range(-2.5f, 2.5f));</div>
<div class="line">        }</div>
<div class="line">     </div>
<div class="line">        public void OnTriggerEnter(Collider other) {</div>
<div class="line">            if (HitByBall(other)) {</div>
<div class="line">                // We&#39;ve been hit!  Tell the modes about it.</div>
<div class="line">                PostGUIEventToModes(&quot;Evt_TargetHit&quot;, other.name);</div>
<div class="line">                Logger.Log(&quot;GUI layer: Target hit by &quot; + other.name + &quot;. Posting event to mode layer.&quot;);</div>
<div class="line">              }</div>
<div class="line">        }</div>
<div class="line">     </div>
<div class="line">        // Update is called once per frame</div>
<div class="line">        public override void Update() {</div>
<div class="line">            base.Update();</div>
<div class="line">            // Per-frame logic goes here.</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd>Section <a class="el" href="#P3AwareObjects">P3Aware Objects</a> and class <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_p3_aware.html">P3Aware</a>.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="P3Playfield"></a>
P3Playfield</h1>
<p>SceneController ensures that an instance of P3Playfield exists in the scene. P3Playfield is a prefab that represents the virtual counterpart to some of the hardware.</p>
<p>It contains:</p><ul>
<li>an avatar for the ball and its path (for detecting when the ball hits a virtual target in-scene)</li>
<li>avatars for flippers and slingshots</li>
<li>virtual rollover switches (gates) for the outlane and return lanes</li>
<li>virtual rollover switches (gates) for the side targets</li>
<li>virtual rollover switches (gates) in front of each wall of the P3's wall/scoop assembly</li>
<li>an overlay to illustrate where the flippers and slings are situated relative to the scene</li>
<li>a virtual version of the infrared grid used for tracking the ball when simulating game play</li>
</ul>
<p>The prefab has an associated <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_p3_playfield.html">P3Playfield</a> class. Some helpful boolean properties of this class can be flipped using checkboxes in the inspector:</p><ul>
<li>Show Ball Path</li>
<li>Show Flippers</li>
<li>Show Slingshots</li>
<li>Show Playfield Overlay</li>
<li>Show IR Grid</li>
</ul>
<p>Note: Do not alter the P3Playfield prefab. It is critical to the proper functioning of your app.</p>
<h1 class="doxsection"><a class="anchor" id="Audio"></a>
Audio</h1>
<p>The <a class="el" href="interface_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_i_audio.html">IAudio</a> interface exists to facilitate audio functionality. This interface is implemented in <a class="el" href="class_multimorphic_1_1_p3_s_a_1_1_g_u_i_1_1_p3_s_a_audio.html">P3SAAudio</a>, which you can customize for your own app. The implementations of the IAudio methods allow the scripts and prefabs in the P3App framework to use the same audio methodology as your app. For example, the settings editor, the profile editor and the high score name editor make use of the Audio calls. </p><dl class="section see"><dt>See also</dt><dd>Classes <a class="el" href="class_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_audio.html">Audio</a>, <a class="el" href="class_multimorphic_1_1_p3_s_a_1_1_g_u_i_1_1_p3_s_a_audio.html">P3SAAudio</a> and interface <a class="el" href="interface_multimorphic_1_1_p3_app_1_1_g_u_i_1_1_i_audio.html">IAudio</a>.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="EventsInGUILayer"></a>
Events in GUI Layer</h1>
<p>Note - This section describes how to send and receive events in GUI scripts. For sending and receiving events in Modes, please refer to <a class="el" href="_mode_layer.html#EventsInModeLayer">Events in Mode Layer</a>.</p>
<h2 class="doxsection"><a class="anchor" id="ReceivingModeEventsInGUI"></a>
Receiving Mode Events In GUI Scripts</h2>
<p>Modes can send events to GUI scripts to pass information or to request an action. These events are typically referred to as ModeToGUI Events. The following example shows how to subscribe to a ModeToGUI Event in a GUI script:</p>
<div class="fragment"><div class="line">// This script needs to inherit from P3Aware (or another descendent of P3Aware).</div>
<div class="line">// Then the CreateEventHandlers() method is overridden like this:</div>
<div class="line">protected override void CreateEventHandlers() {</div>
<div class="line">    // Call base.CreateEventHandlers so all parent subscriptions are made</div>
<div class="line">    base.CreateEventHandlers();</div>
<div class="line">    // Now subscribe to the &quot;Evt_SceneCompleted&quot; event with the CompleteEvent handling method</div>
<div class="line">    AddModeEventHandler(&quot;Evt_SceneCompleted&quot;, CompleteEvent);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Define the CompleteEvent handling method.</div>
<div class="line">public void CompleteEvent(string eventName, object eventObject) {</div>
<div class="line">    // Cast the incoming data into the expected type</div>
<div class="line">    SceneCompleteInfo info = (SceneCompleteInfo)eventObject;</div>
<div class="line">    // Do something.</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="SendingGUIEventsToModes"></a>
Sending Events To Modes</h2>
<p>GUI scripts can send events to Modes to pass information or to request an action. These events are typically referred to as GUIToMode events. The following example shows how to send GUI events to Modes: </p><div class="fragment"><div class="line">// This script needs to inherit from P3Aware (or another descendent of P3Aware).  Otherwise it can&#39;t post GUIToMode events.</div>
<div class="line">// Post the &quot;data&quot; object with the event name of &quot;Evt_EventABC&quot;.</div>
<div class="line">PostGUIEventToModes(&quot;Evt_EventABC&quot;, data);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
