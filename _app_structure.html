<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P3-SDK: Structure of a P3 App</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">P3-SDK<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">P3 Software Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_app_structure.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Structure of a P3 App </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__docs_220_01_structure"></a></p>
<p><img src="AppStructure.png" alt="" class="inline" title="Application Structure"/>    </p>
<h1 class="doxsection"><a class="anchor" id="ModeGUI"></a>
The Layers: Mode and GUI</h1>
<p>All administrative activities need to happen in the mode layer. This includes things like starting the game, keeping score, ball counting, deciding which player should be playing, deciding when to change scenes, etc. Importantly, all communication with the mechanisms needs to happen in the mode layer. Think of the mode layer as the decision-making side, the business logic.</p>
<p>All of the audio/visual activities need to happen in the GUI layer. This includes all the visual aspects of the game, plus things like triggering sounds, virtual object collision detection, showing the score, popup messages, etc. Think of the GUI layer as the displaying and notifying side.</p>
<p>Most of the responsibility for actually running the game lies in the mode layer. Most things that happen in the GUI layer should only happen because a mode sent an event to the UI. If the UI needs to trigger something, it should send an event to the mode layer to let the modes decide what should happen next (which will likely result in more events). This may seem like it's introducing extra event traffic, but organizationally and thread-wise, it's essential. It's easy to fall into the trap of letting your GUI layer take on too much responsibility. When in doubt, ask "who directs this action?". The answer should almost always be "the modes".</p>
<h1 class="doxsection"><a class="anchor" id="Modes"></a>
Modes</h1>
<p>The concept of modes inside a pinball game should be familiar. Multiball mode or double-scoring mode would be common examples in modern pinball machines. On the P3 platform, modes are the implementation of the rules of the game, how the game proceeds, and how mechanisms are handled.</p>
<p>The P3 framework uses modes to drive almost everything, even outside of the player's game. For example, there is also a service menu mode, attract mode, and coin-taking mode. There are also modes to interact with each of the mechanisms in the machine- both built-in and those that are part of a playfield module.</p>
<p>Modes receive events from the hardware to notify of switch activity and can control the hardware by firing similar events. A mode can also communicate with the GUI layer or other modes via events.</p>
<p>Logically, a mode can be started and stopped. While running, it has some purpose or activity to be administered. In general, the more focused a mode's purpose is, the easier it will be to understand, debug, modify, and reuse. It is best to avoid overly complicated modes that try to handle many things at once.</p>
<p>Modes are stackable to assist with this separation of tasks. For example, you could have multiball and double-scoring mode active simultaneously. An in-game mode with complicated rules could be controlled by several modes running simultaneously.</p>
<p>Modes also have priority. For example, a hurry-up mode may temporarily override a scoring feature mode.</p>
<p>Modes can cause other modes to be created, started or stopped. Some modes could be considered to be the parent of other modes. Some modes may lock out other modes or prevent them from starting.</p>
<p>Once instantiated, a mode can be started and stopped any number of times.</p>
<h1 class="doxsection"><a class="anchor" id="FrameworkAnalogy"></a>
An Analogy For The Framework</h1>
<p>A structure of a P3 app can be loosely thought of using a theatrical production as an analogy. </p><table border="1" style="width:100%">
<tr bgcolor="#BBBBBB">
<th>Theatrical element</th><th>Responsibilities</th><th>P3 Framework Equivalent</th></tr>
<tr>
<td>Producer</td><td>Provide a working environment for the directors</td><td>P3Controller object</td></tr>
<tr>
<td>Director </td><td>Manage the subdirectors, oversee everything.</td><td>Mode object (specifically, base app mode)</td></tr>
<tr>
<td>Subdirectors (e.g. lighting director, musical director, extras director)</td><td>Manage a focused portion of the production.</td><td>Mode objects (e.g attract mode, multiball mode)</td></tr>
<tr>
<td>Director's megaphone</td><td>Communicate from director to stage manager and actors</td><td>Events (specifically, from the modes to the GUI)</td></tr>
<tr bgcolor="#99CC99">
<td>⇧Administration&#160;&#160;&#160;&#160;&#160;&#160;&#160;⇩Presentation</td><td>⇧Conducting&#160;&#160;&#160;&#160;&#160;&#160;&#160;⇩Entertaining</td><td>⇧Mode layer&#160;&#160;&#160;&#160;&#160;&#160;&#160;⇩GUI layer</td></tr>
<tr>
<td>Stage/Set</td><td>Provide a place for the audio/visual action to play out</td><td>Unity scene</td></tr>
<tr>
<td>Stage manager</td><td>Manage the placement of scenery and actors</td><td>SceneController object</td></tr>
<tr>
<td>Actors</td><td>Follow stage manager and directors' instructions, look good, interact with other actors</td><td>P3Aware objects, Unity GameObjects</td></tr>
<tr>
<td>Radio headsets</td><td>Communicate from stage to directors</td><td>Events (specifically, from the GUI to the modes)</td></tr>
</table>
<p>Note the separation at the green line. In a P3 app, this separation is critical to ensure safe memory management. The mode layer activities occur in a separate thread from the GUI layer activities. Communication is achieved via events which are broadcast from the mode layer to the GUI layer (or vice versa). Event handlers react accordingly. Modes can also send events to each other on the mode layer.</p>
<p>Additional References:</p><ul>
<li><a href="https://en.wikipedia.org/wiki/Actor_model#Fundamental_concepts">Actor Model Fundamental Concepts</a></li>
<li><a href="https://en.wikipedia.org/wiki/Thread_safety">Thread Safety</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
