<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>P3-SDK: Multimorphic.P3App.Modes.MRPIConnectionController Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">P3-SDK<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">P3 Software Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_connection_controller.html','','class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_connection_controller-members'); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Multimorphic.P3App.Modes.MRPIConnectionController Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A non-mode that maintains the connection to a remote processor and relays messages to it via separate thread and thread-safe message queue. It takes its orders from the <a class="el" href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_manager_mode.html" title="This Mode registers mode event handlers to deal with RPI specific events and relays them to the MRPIC...">MRPIManagerMode</a> (via ModeEvents it receives) so one should not find it necessary to directly invoke methods in this class from anywhere other than <a class="el" href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_manager_mode.html" title="This Mode registers mode event handlers to deal with RPI specific events and relays them to the MRPIC...">MRPIManagerMode</a>.  
 <a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a5597f5360f5593bb8fa26ca0494eae44" id="r_a5597f5360f5593bb8fa26ca0494eae44"><td class="memItemLeft" align="right" valign="top"><a id="a5597f5360f5593bb8fa26ca0494eae44" name="a5597f5360f5593bb8fa26ca0494eae44"></a>
delegate void&#160;</td><td class="memItemRight" valign="bottom"><b>PostModeEventToModesDel</b> (string evt_name, object arg)</td></tr>
<tr class="memitem:a097841cb5f2e47b9cd4b5dd3d71d8fd5" id="r_a097841cb5f2e47b9cd4b5dd3d71d8fd5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a097841cb5f2e47b9cd4b5dd3d71d8fd5">MRPIConnectionController</a> (string subDirToSync, string init, string command, string altRoot=null, PostModeEventToModesDel postFn=null)</td></tr>
<tr class="memdesc:a097841cb5f2e47b9cd4b5dd3d71d8fd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new connection controller; when started (via .Start()) the controller will attempt a connection to the remote device. If a remote device is found, all files in the specified sub directory (subDirToSync) will be sent to the remote. The last running task on the remote will be killed, and then the remote will be instructed to run the 'init' followed by the <span class="tt">command</span>.  <br /></td></tr>
<tr class="memitem:a417296416eb1802a0983085a0bdc8572" id="r_a417296416eb1802a0983085a0bdc8572"><td class="memItemLeft" align="right" valign="top"><a id="a417296416eb1802a0983085a0bdc8572" name="a417296416eb1802a0983085a0bdc8572"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Start</b> ()</td></tr>
<tr class="memitem:a2ac92234bfab5bf2d645e29eab4c9a4e" id="r_a2ac92234bfab5bf2d645e29eab4c9a4e"><td class="memItemLeft" align="right" valign="top"><a id="a2ac92234bfab5bf2d645e29eab4c9a4e" name="a2ac92234bfab5bf2d645e29eab4c9a4e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>StopRunLoop</b> ()</td></tr>
<tr class="memitem:ab2b866c377398a992a7dd8acccff4cb9" id="r_ab2b866c377398a992a7dd8acccff4cb9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab2b866c377398a992a7dd8acccff4cb9">SyncFiles</a> ()</td></tr>
<tr class="memdesc:ab2b866c377398a992a7dd8acccff4cb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiates the corresponding App on the remote device (e.g., RPi); the process involves: (1) killing any previously running app on the remote device (2) running the app on the remote device (3) checking if a file sync is required Running before checking for updates gets a player into a game quickly most of the time. If a file sync is required (uncommon), we then: (4) the newly launched app is shut down (5) a file sync is performed (6) the newly updated remote app is relaunched.  <br /></td></tr>
<tr class="memitem:a9b93b9442a0692a1e8dfbe375de12b55" id="r_a9b93b9442a0692a1e8dfbe375de12b55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9b93b9442a0692a1e8dfbe375de12b55">StartProgram</a> (string command, string args)</td></tr>
<tr class="memdesc:a9b93b9442a0692a1e8dfbe375de12b55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tells the RPi to run a specific command with specific arguments. This should be the program you just transferred as part of the sync command. The command will be executed in the same directory as the files that were just transfered.  <br /></td></tr>
<tr class="memitem:aed9cc71ca5a4ebc8e9b97169c70e87e8" id="r_aed9cc71ca5a4ebc8e9b97169c70e87e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed9cc71ca5a4ebc8e9b97169c70e87e8">SyncFile</a> (MNetworkTcp client, string path, string _sAltRoot=null)</td></tr>
<tr class="memdesc:aed9cc71ca5a4ebc8e9b97169c70e87e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">construct and send an UpdateFile packet for the file at the given path to the specified client. the path that is sent needs to have the gamename prepended to the path for the sake of organization on  <br /></td></tr>
<tr class="memitem:a190cb8fafdf9d07b3a1a8ee4e9a55682" id="r_a190cb8fafdf9d07b3a1a8ee4e9a55682"><td class="memItemLeft" align="right" valign="top"><a id="a190cb8fafdf9d07b3a1a8ee4e9a55682" name="a190cb8fafdf9d07b3a1a8ee4e9a55682"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>CommandCallback</b> (MNetwork net, MPacket packet)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pro-methods" class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ad66c5b87835e3df0950295666d91308b" id="r_ad66c5b87835e3df0950295666d91308b"><td class="memItemLeft" align="right" valign="top"><a id="ad66c5b87835e3df0950295666d91308b" name="ad66c5b87835e3df0950295666d91308b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>processMRPiMsg</b> (<a class="el" href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_pi_app_message.html">MRPiAppMessage</a> mrpimsg)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A non-mode that maintains the connection to a remote processor and relays messages to it via separate thread and thread-safe message queue. It takes its orders from the <a class="el" href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_manager_mode.html" title="This Mode registers mode event handlers to deal with RPI specific events and relays them to the MRPIC...">MRPIManagerMode</a> (via ModeEvents it receives) so one should not find it necessary to directly invoke methods in this class from anywhere other than <a class="el" href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_manager_mode.html" title="This Mode registers mode event handlers to deal with RPI specific events and relays them to the MRPIC...">MRPIManagerMode</a>. </p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a097841cb5f2e47b9cd4b5dd3d71d8fd5" name="a097841cb5f2e47b9cd4b5dd3d71d8fd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a097841cb5f2e47b9cd4b5dd3d71d8fd5">&#9670;&#160;</a></span>MRPIConnectionController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Multimorphic.P3App.Modes.MRPIConnectionController.MRPIConnectionController </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>subDirToSync</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>init</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>command</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>altRoot</em></span><span class="paramdefsep"> = </span><span class="paramdefval">null</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PostModeEventToModesDel</td>          <td class="paramname"><span class="paramname"><em>postFn</em></span><span class="paramdefsep"> = </span><span class="paramdefval">null</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new connection controller; when started (via .Start()) the controller will attempt a connection to the remote device. If a remote device is found, all files in the specified sub directory (subDirToSync) will be sent to the remote. The last running task on the remote will be killed, and then the remote will be instructed to run the 'init' followed by the <span class="tt">command</span>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">subDirToSync</td><td>Where the files to send to the remote are located; assumed to be a subdir of the current project (if not use altRoot param). This directory includes mygame.py in this example.</td></tr>
    <tr><td class="paramname">init</td><td>Any environment variables that need to be set. E.g., "export SOMETHING=/opt/blah"</td></tr>
    <tr><td class="paramname">command</td><td>The command line to run the remote program. E.g., "python mygame.py"</td></tr>
    <tr><td class="paramname">altRoot</td><td>If we are trying to sync files not stored in the game's App folder for some reason, use this parameter to replace the current working directory</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="a9b93b9442a0692a1e8dfbe375de12b55" name="a9b93b9442a0692a1e8dfbe375de12b55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b93b9442a0692a1e8dfbe375de12b55">&#9670;&#160;</a></span>StartProgram()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Multimorphic.P3App.Modes.MRPIConnectionController.StartProgram </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>command</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>args</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tells the RPi to run a specific command with specific arguments. This should be the program you just transferred as part of the sync command. The command will be executed in the same directory as the files that were just transfered. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>Command.</td></tr>
    <tr><td class="paramname">args</td><td>Arguments.</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aed9cc71ca5a4ebc8e9b97169c70e87e8" name="aed9cc71ca5a4ebc8e9b97169c70e87e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed9cc71ca5a4ebc8e9b97169c70e87e8">&#9670;&#160;</a></span>SyncFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Multimorphic.P3App.Modes.MRPIConnectionController.SyncFile </td>
          <td>(</td>
          <td class="paramtype">MNetworkTcp</td>          <td class="paramname"><span class="paramname"><em>client</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>_sAltRoot</em></span><span class="paramdefsep"> = </span><span class="paramdefval">null</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>construct and send an UpdateFile packet for the file at the given path to the specified client. the path that is sent needs to have the gamename prepended to the path for the sake of organization on </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>Client.</td></tr>
    <tr><td class="paramname">path</td><td>Path (true local path, without game name prepended)</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab2b866c377398a992a7dd8acccff4cb9" name="ab2b866c377398a992a7dd8acccff4cb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2b866c377398a992a7dd8acccff4cb9">&#9670;&#160;</a></span>SyncFiles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Multimorphic.P3App.Modes.MRPIConnectionController.SyncFiles </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiates the corresponding App on the remote device (e.g., RPi); the process involves: (1) killing any previously running app on the remote device (2) running the app on the remote device (3) checking if a file sync is required Running before checking for updates gets a player into a game quickly most of the time. If a file sync is required (uncommon), we then: (4) the newly launched app is shut down (5) a file sync is performed (6) the newly updated remote app is relaunched. </p>
<p>(3) involves computing md5 hashes of all local files and requesting the remote to compute MD5 on the same files then compare the results to determine if an update is required. <br  />
 The filesToUpdate list will grow as this continues and the final stage is to sync each file. At the conclusion of file sync, the current running process on the RPi/MPiServer is killed (e.g., the previous RPiApp) and the new one is launched.</p>
<p>Invoked as soon as a connection is established </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespace_multimorphic.html">Multimorphic</a></li><li class="navelem"><a href="namespace_multimorphic_1_1_p3_app.html">P3App</a></li><li class="navelem"><a href="namespace_multimorphic_1_1_p3_app_1_1_modes.html">Modes</a></li><li class="navelem"><a href="class_multimorphic_1_1_p3_app_1_1_modes_1_1_m_r_p_i_connection_controller.html">MRPIConnectionController</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
